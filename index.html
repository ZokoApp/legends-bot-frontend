<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Legends Bot – Producción</title>

<script>
const user = JSON.parse(localStorage.getItem("legends_user"));
if (!user) window.location.href = "login.html";
</script>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1220">

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:system-ui;
background:radial-gradient(circle at top,#0f172a,#020617);
color:#e5e7eb;
}

.container{max-width:420px;margin:0 auto;padding:28px 20px 40px}
.card{background:rgba(255,255,255,0.04);border-radius:20px;padding:26px 22px 28px;box-shadow:0 30px 60px rgba(0,0,0,.5)}

.user-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px}
.user-info{display:flex;align-items:center;gap:12px}
.user-info img{width:46px;height:46px;border-radius:50%}
.user-name{font-size:.8rem;color:#9ca3af}
.user-name strong{display:block;font-size:.95rem;color:#fff}

.verified{width:16px;height:16px;display:flex}

.field{margin-bottom:18px}
.field label{display:block;font-size:.75rem;color:#9ca3af;margin-bottom:6px}
.field input,.field select{
width:100%;
padding:14px;
border-radius:14px;
border:none;
background:#020617;
color:#e5e7eb;
font-size:.9rem;
}

.actions{display:flex;gap:12px;margin-top:20px}
button{flex:1;padding:14px;border-radius:16px;border:none;font-weight:600}
.btn-primary{background:#2563eb;color:#fff}
.btn-secondary{background:transparent;color:#9ca3af;border:1px solid #555}

.rut-wrapper{position:relative}
.rut-hint{
position:absolute;
top:-38px;
left:0;right:0;
background:#2563eb;
color:white;
font-size:12px;
padding:6px;
border-radius:8px;
text-align:center;
opacity:0;
transition:.25s;
}
.rut-hint.show{opacity:1}
.rut-hint.ok{background:#22c55e}
.rut-hint.error{background:#ef4444}
</style>
</head>

<body>

<div class="container">
<div class="card">

<div class="user-header">
<div class="user-info">
<img src="icons/icon-192.png">
<div class="user-name">
<strong id="userName"></strong>
<span id="userRole"></span>
</div>
<span id="verifiedBadge" class="verified" style="display:none">✔</span>
</div>
<button onclick="logout()">Salir</button>
</div>

<div class="field">
<label>COMPAÑÍA</label>
<select id="company"><option>VTR</option><option>CLARO</option></select>
</div>

<div class="field">
<label>MODO</label>
<select id="mode"><option>Agenda</option></select>
</div>

<div class="field rut-wrapper">
<label>RUT</label>
<input id="rut" placeholder="Ej: 15425846-8">
<div id="rutHint" class="rut-hint">Ej: 15425846-8 (sin puntos)</div>
</div>

<div class="actions">
<button id="btnRun" class="btn-primary">Ejecutar</button>
<button class="btn-secondary">Limpiar</button>
</div>

</div>
</div>

<script>
document.getElementById("userName").innerText = user.nombre;
document.getElementById("userRole").innerText = user.rol;
if(user.rol==="Admin") document.getElementById("verifiedBadge").style.display="flex";

function logout(){
  localStorage.removeItem("legends_user");
  location.href="login.html";
}

/* =========================
   RUT SMART VALIDATOR
   ========================= */
const rutInput = document.getElementById("rut");
const btnRun = document.getElementById("btnRun");
const rutHint = document.getElementById("rutHint");

function isRutValido(rut){
  return /^[0-9]{7,8}-[0-9Kk]$/.test(rut);
}

rutInput.addEventListener("focus", ()=> rutHint.classList.add("show"));

rutInput.addEventListener("input", ()=>{
  const v = rutInput.value.trim();
  if(v===""){
    rutHint.className="rut-hint show";
    btnRun.disabled=false;
    return;
  }
  if(isRutValido(v)){
    rutHint.className="rut-hint show ok";
    btnRun.disabled=false;
  }else{
    rutHint.className="rut-hint show error";
    btnRun.disabled=true;
  }
});
</script>

</body>
</html>
